<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hta2405.unite.mybatis.mapper.MessengerMapper">
    <!-- ChatRoom 관련 -->
    <select id="findAllRooms" resultType="ChatRoom">
        SELECT *
        FROM chat_room
    </select>

    <select id="findRoomById" parameterType="long" resultType="ChatRoom">
        SELECT *
        FROM chat_room
        WHERE chat_room_id = #{chatRoomId}
    </select>

    <insert id="createRoom" parameterType="ChatRoom">
        INSERT INTO chat_room (chat_room_name, creator_id)
        VALUES (#{chatRoomName}, #{creatorId})
    </insert>

    <delete id="deleteRoom" parameterType="long">
        DELETE
        FROM chat_room
        WHERE chat_room_id = #{chatRoomId}
    </delete>

    <!-- ChatMessage 관련 -->
    <select id="findMessagesByRoomId" parameterType="long" resultType="ChatMessage">
        SELECT *
        FROM chat_message
        WHERE chat_room_id = #{chatRoomId}
        ORDER BY chat_message_date ASC
    </select>

    <insert id="saveMessage" parameterType="ChatMessage">
        INSERT INTO chat_message (chat_room_id, sender_id, chat_message_content, chat_message_date)
        VALUES (#{chatRoomId}, #{senderId}, #{chatMessageContent}, NOW())
    </insert>

    <!-- ChatRoomMember 관련 -->
    <select id="findMembersByRoomId" parameterType="long" resultType="string">
        SELECT user_id
        FROM chat_room_member
        WHERE chat_room_id = #{chatRoomId}
    </select>

    <insert id="addMember" parameterType="ChatRoomMember">
        INSERT INTO chat_room_member (chat_room_id, user_id)
        VALUES (#{chatRoomId}, #{userId})
    </insert>

    <delete id="removeMember" parameterType="long">
        DELETE
        FROM chat_room_member
        WHERE chat_room_member_id = #{chatRoomMemberId}
    </delete>
</mapper>

